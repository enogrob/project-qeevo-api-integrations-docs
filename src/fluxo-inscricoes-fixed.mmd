%%{init: {
    "theme": "base",
    "themeVariables": {
        "fontFamily": "arial",
        "fontSize": "12px",
        "primaryColor": "#ffffff",
        "primaryTextColor": "#2c3e50",
        "primaryBorderColor": "#34495e",
        "lineColor": "#34495e",
        "sectionBkgColor": "transparent",
        "altSectionBkgColor": "transparent",
        "gridColor": "#ecf0f1",
        "c0": "#ecf0f1",
        "c1": "#bdc3c7",
        "c2": "#95a5a6",
        "c3": "#7f8c8d"
    }
}}%%

flowchart TD
    
    subgraph SG1 ["ðŸŽ¯ Student Journey"]
        INICIO(("`ðŸš€ **InÃ­cio**
        Aluno interessado
        na bolsa`"))
        CADASTRO["`ðŸ“ **Cadastro**
        E-mail, CPF, Nome
        Nascimento, Celular, CEP`"]
        FIM(("`âœ… **Fim**
        Processo ConcluÃ­do`"))
        LEAD_SOLD(("`ðŸ’° **Lead Vendido**
        ConversÃ£o realizada`"))
    end
    
    subgraph SG2 ["ðŸ’³ Payment & Admission Process"]
        PAYMENT_CHECK{"`ðŸ’³ **Pagamento PEF?**
        Processo de pagamento`"}
        DIGITAL_ADMISSION{"`ðŸ’» **AdmissÃ£o Digital?**
        Processo automatizado`"}
        API_CHECK{"`ðŸ”Œ **API de InscriÃ§Ãµes?**
        IntegraÃ§Ã£o disponÃ­vel`"}
        
        subgraph SG3 ["ðŸ“‹ Document Management"]
            SEND_DOCS["`ðŸ“„ **Enviar Documentos**
            Upload de arquivos`"]
            DOC_CHECK{"`âœ… **DocumentaÃ§Ã£o OK?**
            ValidaÃ§Ã£o de documentos`"}
            REJECT_DOCS["`âŒ **Rejeitar Docs**
            Documentos invÃ¡lidos`"]
        end
        
        subgraph SG4 ["ðŸŽ“ Enrollment Process"]
            ENROLL_DATA["`ðŸ“Š **MatrÃ­cula com Dados**
            Processamento de inscriÃ§Ã£o`"]
            STUDENT_ENROLLED["`ðŸŽ‰ **Aluno Matriculado**
            Sucesso na matrÃ­cula`"]
            VOUCHER["`ðŸŽ« **Comprovante Bolsa**
            Documento de confirmaÃ§Ã£o`"]
            CAMPUS_ENROLL["`ðŸ›ï¸ **MatrÃ­cula no Campus**
            Processo presencial`"]
        end
    end
    
    subgraph SG5 ["âš™ï¸ Integration Systems"]
        INTEGRATION_TYPE{"`ðŸ”§ **Tipo de IntegraÃ§Ã£o**
        Sistema de destino`"}
        API_INTEGRATION{"`ðŸ”Œ **API?**
        IntegraÃ§Ã£o automatizada`"}
        
        subgraph SG6 ["ðŸ”„ Kroton Integration"]
            KROTON_CHECK{"`ðŸŽ“ **Kroton?**
            Sistema Kroton`"}
            KROTON_MODE{"`ðŸ“š **Modalidade Kroton**
            Tipo de curso`"}
            
            SYNC_COURSE["`ðŸ”„ **Cron Job sync_course**
            SincronizaÃ§Ã£o de cursos`"]
            KROTON_BD_1["`ðŸ—„ï¸ **Popula BD**
            InscriÃ§Ãµes Kroton`"]
            KROTON_SEND_1["`ðŸ“¡ **Envio para IES**
            Dados do aluno`"]
            KROTON_ERROR_1{"`âš ï¸ **Erro no Envio?**
            Falha na transmissÃ£o`"}
            KROTON_RETRY["`ðŸ”„ **Reenvio AutomÃ¡tico**
            Tentativa automÃ¡tica`"]
            
            KROTON_BD_2["`ðŸ—„ï¸ **Popula BD**
            InscriÃ§Ãµes presenciais`"]
            KROTON_SEND_2["`ðŸ“¡ **Envio para IES**
            Modalidade presencial`"]
        end
        
        subgraph SG7 ["ðŸ›ï¸ EstÃ¡cio Integration"]
            ESTACIO_BD["`ðŸ—„ï¸ **Popula BD**
            InscriÃ§Ãµes EstÃ¡cio`"]
            ONETRUST["`ðŸ›¡ï¸ **OneTrust**
            Compliance LGPD`"]
            ESTACIO_SEND["`ðŸ“¡ **Envio para IES**
            Sistema EstÃ¡cio`"]
            ESTACIO_ERROR{"`âš ï¸ **Erro no Envio?**
            Falha na transmissÃ£o`"}
            MANUAL_SEND["`âœ‹ **Envio Manual**
            IntervenÃ§Ã£o necessÃ¡ria`"]
        end
        
        subgraph SG8 ["ðŸ•·ï¸ Crawler Integration"]
            CRAWLER_BD["`ðŸ—„ï¸ **BD Subscribe Bot**
            Sistema de captura`"]
            CRAWLER_SEND["`ðŸ“¡ **Envio para IES**
            Via crawler`"]
        end
        
        subgraph SG9 ["ðŸ“Š Lead Management"]
            LEAD_BD_KROTON["`ðŸ—„ï¸ **BD InscriÃ§Ãµes**
            Type: captaÃ§Ã£o`"]
            LEAD_ONETRUST["`ðŸ›¡ï¸ **OneTrust Lead**
            LGPD para leads`"]
            LEAD_SEND_KROTON["`ðŸ“¡ **Envio Lead**
            codAgentPdv: 14412833`"]
            
            LEAD_BD_ESTACIO["`ðŸ—„ï¸ **BD InscriÃ§Ãµes**
            SeparaÃ§Ã£o por tipo`"]
            LEAD_SEND_ESTACIO["`ðŸ“¡ **Envio Lead**
            Sistema EstÃ¡cio`"]
        end
    end
    
    subgraph SG10 ["ðŸ”§ Legacy Process"]
        CONFIG_CHECK{"`âš™ï¸ **Config AdmissÃ£o?**
        ConfiguraÃ§Ã£o disponÃ­vel`"}
        ADMISSION_CHECK{"`ðŸŽ¯ **admission_created?**
        Processo criado`"}
        ENROLL_CHECK{"`ðŸ“‹ **admission_enroll?**
        MatrÃ­cula disponÃ­vel`"}
        
        CONTRACT_1["`ðŸ“‹ **Assinar Contrato**
        Primeira assinatura`"]
        SEND_DOCS_1["`ðŸ“„ **Envio Documentos**
        Primeira remessa`"]
        SELECTIVE_1["`ðŸŽ¯ **Processo Seletivo**
        Primeira avaliaÃ§Ã£o`"]
        
        CONTRACT_2["`ðŸ“‹ **Assinar Contrato**
        Segunda assinatura`"]
        SEND_DOCS_2["`ðŸ“„ **Envio Documentos**
        Segunda remessa`"]
        SELECTIVE_2["`ðŸŽ¯ **Processo Seletivo**
        Segunda avaliaÃ§Ã£o`"]
    end
    
    %% Main Flow
    INICIO --> CADASTRO
    CADASTRO --> PAYMENT_CHECK
    
    %% Payment Flow
    PAYMENT_CHECK -->|"`ðŸ’³ **Sim**
    Processo PEF`"| DIGITAL_ADMISSION
    PAYMENT_CHECK -->|"`âŒ **NÃ£o**
    Sem pagamento`"| INTEGRATION_TYPE
    
    %% Digital Admission Flow
    DIGITAL_ADMISSION -->|"`ðŸ’» **Sim**
    Processo digital`"| API_CHECK
    DIGITAL_ADMISSION -->|"`ðŸ“‹ **NÃ£o**
    Processo manual`"| API_CHECK
    
    API_CHECK -->|"`ðŸ”Œ **Sim**
    API disponÃ­vel`"| SEND_DOCS
    API_CHECK -->|"`âŒ **NÃ£o**
    Sem API`"| CONFIG_CHECK
    
    %% Document Management Flow
    SEND_DOCS --> DOC_CHECK
    DOC_CHECK -->|"`âœ… **Sim**
    Documentos OK`"| ENROLL_DATA
    DOC_CHECK -->|"`âŒ **NÃ£o**
    Documentos invÃ¡lidos`"| REJECT_DOCS
    REJECT_DOCS --> ENROLL_DATA
    
    %% Enrollment Flow
    ENROLL_DATA --> STUDENT_ENROLLED
    STUDENT_ENROLLED --> VOUCHER
    VOUCHER --> FIM
    
    %% Legacy Configuration Flow
    CONFIG_CHECK -->|"`âŒ **NÃ£o**
    Sem configuraÃ§Ã£o`"| ADMISSION_CHECK
    CONFIG_CHECK -->|"`âœ… **Sim**
    Com configuraÃ§Ã£o`"| ENROLL_CHECK
    
    ADMISSION_CHECK -->|"`âœ… **Sim**
    AdmissÃ£o criada`"| CONTRACT_1
    ADMISSION_CHECK -->|"`âŒ **NÃ£o**
    Sem admissÃ£o`"| ENROLL_DATA
    
    CONTRACT_1 --> SEND_DOCS_1
    SEND_DOCS_1 --> SELECTIVE_1
    SELECTIVE_1 --> ENROLL_DATA
    
    ENROLL_CHECK -->|"`âœ… **Sim**
    MatrÃ­cula habilitada`"| CONTRACT_2
    ENROLL_CHECK -->|"`âŒ **NÃ£o**
    MatrÃ­cula direta`"| SELECTIVE_2
    
    CONTRACT_2 --> SEND_DOCS_2
    SEND_DOCS_2 --> SELECTIVE_2
    SELECTIVE_2 --> ENROLL_DATA
    
    %% Integration Flow
    INTEGRATION_TYPE --> API_INTEGRATION
    API_INTEGRATION -->|"`ðŸ”Œ **Sim**
    API disponÃ­vel`"| KROTON_CHECK
    API_INTEGRATION -->|"`ðŸ•·ï¸ **Crawler**
    Captura automatizada`"| CRAWLER_BD
    
    %% Kroton Integration Flow
    KROTON_CHECK -->|"`ðŸŽ“ **Kroton**
    Sistema Kroton`"| KROTON_BD_1
    KROTON_CHECK -->|"`ðŸ›ï¸ **EstÃ¡cio**
    Sistema EstÃ¡cio`"| ESTACIO_BD
    
    KROTON_BD_1 --> LEAD_ONETRUST
    LEAD_ONETRUST --> LEAD_SEND_KROTON
    LEAD_SEND_KROTON --> LEAD_SOLD
    
    ESTACIO_BD --> LEAD_BD_ESTACIO
    LEAD_BD_ESTACIO --> LEAD_SEND_ESTACIO
    LEAD_SEND_ESTACIO --> LEAD_SOLD
    
    %% Crawler Flow
    CRAWLER_BD --> CRAWLER_SEND
    CRAWLER_SEND --> LEAD_SOLD
    
    %% Legacy Kroton Flow for non-API
    API_CHECK -->|"`âŒ **NÃ£o**
    Kroton sem API`"| KROTON_MODE
    KROTON_MODE -->|"`ðŸ“š **Semipresencial**
    Modalidade hÃ­brida`"| SYNC_COURSE
    KROTON_MODE -->|"`ðŸ›ï¸ **Presencial**
    Modalidade campus`"| KROTON_BD_2
    
    SYNC_COURSE --> KROTON_BD_1
    KROTON_BD_1 --> KROTON_SEND_1
    KROTON_SEND_1 --> KROTON_ERROR_1
    KROTON_ERROR_1 -->|"`âœ… **NÃ£o**
    Sucesso`"| IES_NOTIFICATION
    KROTON_ERROR_1 -->|"`âš ï¸ **Sim**
    Erro ocorrido`"| KROTON_RETRY
    KROTON_RETRY --> IES_NOTIFICATION
    
    KROTON_BD_2 --> KROTON_SEND_2
    KROTON_SEND_2 --> KROTON_ERROR_1
    
    %% EstÃ¡cio Flow for non-API
    API_CHECK -->|"`âŒ **NÃ£o**
    EstÃ¡cio sem API`"| ESTACIO_BD
    ESTACIO_BD --> ONETRUST
    ONETRUST --> ESTACIO_SEND
    ESTACIO_SEND --> ESTACIO_ERROR
    ESTACIO_ERROR -->|"`âœ… **NÃ£o**
    Sucesso`"| IES_NOTIFICATION
    ESTACIO_ERROR -->|"`âš ï¸ **Sim**
    Erro ocorrido`"| MANUAL_SEND
    MANUAL_SEND --> IES_NOTIFICATION
    
    %% Final notification
    IES_NOTIFICATION["`ðŸ“¢ **IES Notifica**
    ConfirmaÃ§Ã£o do processo`"]
    IES_NOTIFICATION --> CAMPUS_ENROLL
    CAMPUS_ENROLL --> FIM
    
    %% Final Lead Flow
    LEAD_SOLD --> FIM
    
    %% ===== STYLING SECTION =====
    %% Custom color scheme as requested
    
    %% Start/End nodes - Yellow
    classDef startEndClass fill:#fff3cd,stroke:#ffc107,stroke-width:3px,color:#856404
    
    %% Decision/IF nodes - Pink (more vibrant pink)
    classDef decisionClass fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    
    %% Action/Process nodes - Grey
    classDef actionClass fill:#e9ecef,stroke:#6c757d,stroke-width:2px,color:#495057
    
    %% Comment/Document nodes - Green
    classDef commentClass fill:#d4edda,stroke:#28a745,stroke-width:2px,color:#155724
    
    %% Integration nodes - Light Blue (for database/integration operations)
    classDef integrationClass fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px,color:#0c5460
    
    %% Error nodes - Red
    classDef errorClass fill:#f5c6cb,stroke:#dc3545,stroke-width:2px,color:#721c24
    
    %% Apply classes to nodes
    class INICIO,FIM,LEAD_SOLD startEndClass
    class PAYMENT_CHECK,DIGITAL_ADMISSION,API_CHECK,DOC_CHECK,CONFIG_CHECK,ADMISSION_CHECK,ENROLL_CHECK,INTEGRATION_TYPE,API_INTEGRATION,KROTON_CHECK,KROTON_MODE,KROTON_ERROR_1,ESTACIO_ERROR decisionClass
    class CADASTRO,ENROLL_DATA,STUDENT_ENROLLED,VOUCHER,CAMPUS_ENROLL,SYNC_COURSE,KROTON_SEND_1,KROTON_SEND_2,ESTACIO_SEND,CRAWLER_SEND,LEAD_SEND_KROTON,LEAD_SEND_ESTACIO,IES_NOTIFICATION,SELECTIVE_1,SELECTIVE_2 actionClass
    class SEND_DOCS,REJECT_DOCS,CONTRACT_1,SEND_DOCS_1,CONTRACT_2,SEND_DOCS_2,ONETRUST,LEAD_ONETRUST commentClass
    class KROTON_BD_1,KROTON_BD_2,ESTACIO_BD,CRAWLER_BD,LEAD_BD_KROTON,LEAD_BD_ESTACIO integrationClass
    class KROTON_RETRY,MANUAL_SEND errorClass
    
    %% Force pink styling for decision nodes (override any theme conflicts)
    style PAYMENT_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style DIGITAL_ADMISSION fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style API_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style DOC_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style CONFIG_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style ADMISSION_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style ENROLL_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style INTEGRATION_TYPE fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style API_INTEGRATION fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style KROTON_CHECK fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style KROTON_MODE fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style KROTON_ERROR_1 fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f
    style ESTACIO_ERROR fill:#fce4ec,stroke:#e91e63,stroke-width:2px,color:#880e4f